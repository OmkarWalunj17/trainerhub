<div class="page-container">
  <div class="bg-shape shape-1"></div>
  <div class="bg-shape shape-2"></div>
  <div class="bg-grid"></div>

  <div class="content-card">
    <div class="card-header">
      <div class="logo-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white"
          stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
          <polyline points="14 2 14 8 20 8" />
          <line x1="16" y1="13" x2="8" y2="13" />
          <line x1="16" y1="17" x2="8" y2="17" />
          <polyline points="10 9 9 9 8 9" />
        </svg>
      </div>
      <h2 class="title">Requirements</h2>
      <p class="subtitle">View and manage all training requirements.</p>
    </div>

    <div class="controls-row">
      <div class="form-group search-group">
        <label for="searchInput">Search</label>
        <div class="input-wrapper">
          <span class="input-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8" />
              <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
          </span>
          <input id="searchInput" type="text" placeholder="Requirement Title" [(ngModel)]="searchI"
            (input)="search()" [disabled]="loading" />
        </div>
      </div>

      <div class="form-group filter-group">
        <label for="statusFilter">Filter by Status</label>
        <div class="select-wrapper">
          <select id="statusFilter" [(ngModel)]="statusB" [disabled]="loading"  (change)="filter()">
            <option value="">All Status</option>
            <option value="Open">Open</option>
            <option value="Closed">Closed</option>
          </select>
          <span class="select-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m6 9 6 6 6-6" />
            </svg>
          </span>
        </div>
      </div>
    </div>

    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <span>Loading requirements...</span>
    </div>

    <div *ngIf="!loading" class="table-wrapper">  
      <table class="req-table">
        <thead>
          <tr>
            <th>S.No</th>
            <th>Title</th>
            <th>Department</th>
            <th>Duration</th>
            <th>Mode</th>
            <th>Status</th>
            <th>Payment Status</th>
            <th>Trainer</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let r of pagedRequirement; index as i">
            <td class="sno">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
            <td class="bold-cell">{{ r.title }}</td>
            <td>{{ r.department }}</td>
            <td>{{ r.duration }}</td>
            <td>{{ r.mode }}</td>

            <td>
              <span class="status-badge" [class.status-open]="r.status === 'Open'"
                [class.status-closed]="r.status === 'Closed'">
                {{ r.status }}
              </span>
            </td>

            <td>
              <span class="status-badge" 
                [class.payment-pending]="r.paymentStatus === 'Pending'"
                [class.payment-completed]="r.paymentStatus === 'Completed'"
                [class.payment-na]="r.paymentStatus === 'N/A' || !r.paymentStatus">
                {{ r.paymentStatus || 'N/A' }}
              </span>
            </td>

            <td>
              <span class="assign-badge" [class.assigned]="r.trainer?.trainerId != null"
                [class.unassigned]="r.trainer?.trainerId == null">
                {{ r.trainer?.trainerId != null ? 'Assigned' : 'Not Assigned' }}
              </span>
            </td>

            <td class="actions-cell">
              <button type="button" class="btn-action btn-edit" (click)="editRequirement(r.requirementId)">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                </svg>
                Edit
              </button>

              <button type="button" class="btn-action btn-delete" (click)="requestDelete(r.requirementId, r.title)">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6" />
                  <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
                  <path d="M10 11v6" />
                  <path d="M14 11v6" />
                  <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" />
                </svg>
                Delete
              </button>

              <button type="button" *ngIf="r.trainer?.trainerId != null" class="btn-action btn-view"
                (click)="viewTrainer(r.requirementId, r.trainer?.trainerId)">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                  <circle cx="12" cy="12" r="3" />
                </svg>
                View Trainer
              </button>
            </td>
          </tr>

          <tr *ngIf="pagedRequirement.length === 0">
            <td colspan="9" class="empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
                stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="8" x2="12" y2="12" />
                <line x1="12" y1="16" x2="12.01" y2="16" />
              </svg>
              <p>No requirements found.</p>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
    <div class="pagination-bar" *ngIf="pagedRequirement.length > 0">

      <div class="pager">
        <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>

        <span class="page-info">
          Page {{ currentPage }} of {{ totalPages }}
        </span>

        <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
      </div>

    </div>

  </div>
</div>

<app-confirm-modal [isVisible]="showConfirmModal" [message]="confirmMessage" [confirmLabel]="'Yes, Delete'"
  [cancelLabel]="'Cancel'" (onConfirm)="onConfirmDelete()" (onCancel)="onCancelDelete()">
</app-confirm-modal>

<app-success-modal [isVisible]="showSuccessModal" [message]="successMessage" (onClose)="onSuccessClose()">
</app-success-modal>

<app-failure-modal [isVisible]="showFailureModal" [message]="failureMessage" [buttonText]="'Okay'"
  (onClose)="onFailureClose()">
</app-failure-modal>